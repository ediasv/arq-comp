# justfile

SRC_DIR := "src"
TEST_DIR := "test"
WORK_DIR := "."

# Compila todos os arquivos
compile:
    @echo "Compilando arquivos VHDL..."
    ghdl -a --workdir={{ WORK_DIR }} {{ SRC_DIR }}/*.vhd
    ghdl -a --workdir={{ WORK_DIR }} {{ TEST_DIR }}/*.vhd

# Elabora o testbench
elaborate:
    @echo "Elaborando testbench..."
    ghdl -e --workdir={{ WORK_DIR }} processador_tb

# Executa a simulação
run:
    @echo "Executando simulação..."
    ghdl -r --workdir={{ WORK_DIR }} processador_tb --wave=processador_tb.ghw --stop-time=10ms

# Visualiza forma de onda
view:
    @echo "Abrindo GTKWave..."
    gtkwave processador_tb.ghw

# Limpa arquivos gerados
clean:
    @echo "Limpando arquivos..."
    rm -f *.o *.cf *.ghw processador_tb

sm: clean compile
    @echo "Elaborando testbench da SM"
    ghdl -e --workdir={{ WORK_DIR }} sm_tb
    @echo "Executando simulação da SM"
    ghdl -r --workdir={{ WORK_DIR }} sm_tb --wave=sm_tb.ghw --stop-time=10ms

# Executa tudo
all: clean compile elaborate run
